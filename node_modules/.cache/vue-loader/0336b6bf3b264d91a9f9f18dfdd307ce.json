{"remainingRequest":"/home/vevanta/Рабочий стол/building_widtgets/node_modules/vue-loader-v16/dist/index.js??ref--0-1!/home/vevanta/Рабочий стол/building_widtgets/src/pages/client/crm/index.vue?vue&type=style&index=0&id=17bd0a21&lang=css","dependencies":[{"path":"/home/vevanta/Рабочий стол/building_widtgets/src/pages/client/crm/index.vue","mtime":1638780473540},{"path":"/home/vevanta/Рабочий стол/building_widtgets/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vevanta/Рабочий стол/building_widtgets/node_modules/vue-loader-v16/dist/stylePostLoader.js","mtime":1632349277000},{"path":"/home/vevanta/Рабочий стол/building_widtgets/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/vevanta/Рабочий стол/building_widtgets/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/vevanta/Рабочий стол/building_widtgets/node_modules/vue-loader-v16/dist/index.js","mtime":1632349277000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5wcmVsb2FkX19jb250IHsKICB3aWR0aDogMTAwJTsKICBoZWlnaHQ6IDEwMCU7CiAgYmFja2dyb3VuZDogcmdiKDI1NSAyNTUgMjU1IC8gNzQlKTsKfQoKLnByZWxvYWRfX2NvbnQgaW1nIHsKICB3aWR0aDogNjBweDsKICBtYXJnaW4tcmlnaHQ6IDQwMHB4Owp9Cgo="},{"version":3,"sources":["/home/vevanta/Рабочий стол/building_widtgets/src/pages/client/crm/index.vue"],"names":[],"mappings":";AAwWA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACb,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACX,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACZ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC;AACpC;;AAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE;EACjB,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACX,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AACrB","file":"/home/vevanta/Рабочий стол/building_widtgets/src/pages/client/crm/index.vue","sourceRoot":"","sourcesContent":["<template>\n  <div class=\"\">\n  <div class=\"uk-flex uk-flex-column container\">\n    <div class=\"uk-grid uk-grid-small uk-margin-top\">\n      <div class=\"fs22 uk-text-left fnt-bld\">\n        CRM\n      </div>\n    </div>\n\n    <div class=\"uk-position-absolute uk-width-1-1 uk-height-1-1 preload__cont\" v-show=\"statusLeads === 0\">\n      <div class=\"uk-position-center\">\n        <img src=\"/images/icons/preload.svg\" alt=\"\">\n      </div>\n    </div>\n\n    <div class=\"uk-grid uk-child-width-1-4\">\n      <div class=\"\">\n        <div class=\"uk-text-left uk-margin-top uk-margin-small-bottom fnt-bld\">\n          Домен\n        </div>\n          <div class=\"\">\n            <select\n              class=\"uk-select\"\n              v-model=\"filter.domain\"\n              @change=\"filter.page = 1; searchLeads()\"\n              >\n              <option disabled value=\"\">Домен</option>\n              <template v-for=\"(domain, index) in domains\" :key=\"index\">\n                <option\n                :value=\"[domain.id_domain]\"\n                v-if=\"(domain.id_company==filter.company[0]) || !filter.company.length\"\n                >\n                  {{domain.site_domain}}\n                </option>\n              </template>\n            </select>\n          </div>\n          <div class=\"uk-text-left uk-margin-large-top fnt-bld\">\n            Общее количество заявок: {{total}}\n          </div>\n      </div>\n      <div class=\"\">\n        <div class=\"\">\n          <div class=\"uk-text-left uk-margin-top uk-margin-small-bottom fnt-bld\">\n            Компании\n          </div>\n            <div class=\"\">\n              <select\n                class=\"uk-select\"\n                v-model=\"filter.company\"\n                @change=\"filter.page = 1; filter.domain = []; searchLeads()\"\n                >\n                <option disabled value=\"\">Компании</option>\n                <option\n                  v-for=\"(company, index) in companies\"\n                  :key=\"index\"\n                  :value=\"[company.id_company]\"\n                  >\n                  {{company.name_company}}\n                </option>\n              </select>\n            </div>\n        </div>\n      </div>\n      <div class=\"\">\n        <div class=\"\">\n          <div class=\"uk-text-left uk-margin-top uk-margin-small-bottom fnt-bld\">\n            Источник\n          </div>\n            <div class=\"\">\n              <select\n                class=\"uk-select\"\n                v-model=\"filter.origin\"\n                @change=\"filter.page = 1; searchLeads()\"\n                >\n                <option disabled value=\"\">Источник</option>\n                <option v-for=\"(origin, index) in origins\" :key=\"index\" :value=\"[origin.id_origin]\">\n                  {{origin.name_origin}}\n                </option>\n              </select>\n            </div>\n        </div>\n      </div>\n      <div class=\"\">\n        <div class=\"\">\n          <div class=\"uk-text-left uk-margin-top uk-margin-small-bottom fnt-bld\">\n            Дата\n          </div>\n            <div class=\"\">\n              <input\n                class=\"uk-select\"\n                v-model=\"filter.date_period[0]\"\n                @change=\"startLeadDate\"\n                type=\"date\" data-uk-datepicker=\"{format:'DD.MM.YYYY'}\">\n            </div>\n            <div class=\"\">\n              <input\n                class=\"uk-select uk-margin-top\"\n                v-model=\"filter.date_period[1]\"\n                @change=\"startLeadDate\"\n                type=\"date\" data-uk-datepicker=\"{format:'DD.MM.YYYY'}\">\n            </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n    <div class=\"uk-box-shadow-medium uk-background-default container uk-padding-small uk-margin-top brd12\" ref=\"tablesLeads\">\n      <div class=\"uk-overflow-auto\">\n        <div>\n      <table class=\"uk-table uk-table-striped uk-table-hover uk-table-small uk-table-middle\">\n          <caption></caption>\n          <thead>\n              <tr class=\"\">\n                <th class=\"\">Телефон</th>\n                <th class=\"\">E-mail</th>\n                <th class=\"\">Имя</th>\n                <th class=\"\">Форма</th>\n                <th class=\"\">Доменное имя</th>\n                <th class=\"\">URL</th>\n                <th class=\"\">Дата</th>\n                <th class=\"\">_ga</th>\n                <th class=\"\">roistat_visit</th>\n                <th class=\"\">ya_client_id</th>\n                <th class=\"\">name_origin</th>\n              </tr>\n          </thead>\n          <tfoot>\n            <tr class=\"\">\n              <th class=\"\">Телефон</th>\n              <th class=\"\">E-mail</th>\n              <th class=\"\">Имя</th>\n              <th class=\"\">Форма</th>\n              <th class=\"\">Доменное имя</th>\n              <th class=\"\">URL</th>\n              <th class=\"\">Дата</th>\n              <th class=\"\">_ga</th>\n              <th class=\"\">roistat_visit</th>\n              <th class=\"\">ya_client_id</th>\n              <th class=\"\">Источник</th>\n            </tr>\n          </tfoot>\n          <tbody v-dragscroll>\n              <tr class=\"uk-width-medium uk-text-left\" v-for=\"(table, index) in tables\" :key=\"index\">\n              <td class=\"\">{{ table.phone_lead }}</td>\n              <td class=\"uk-text-truncate\">{{ table.email_lead }}</td>\n              <td class=\"\">{{ table.name_lead }}</td>\n              <td>\n                <div style=\"width: 300px; height: 75px; overflow: hidden; text-overflow: ellipsis\">\n                  {{ table.msg_lead }}\n                </div>\n              </td>\n              <td class=\"\">{{ table.site_domain }}</td>\n              <td class=\"\">\n                <div style=\"width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\">\n                  {{ table.url_lead }}\n                </div>\n              </td>\n              <td class=\"\">{{ table.first_date }}</td>\n              <td class=\"\">{{ table.go_client_id }}</td>\n              <td class=\"\">{{ table.roistat_visit }}</td>\n              <td class=\"\">{{ table.ya_client_id }}</td>\n              <td class=\"uk-text-truncate\">{{ table.name_origin }}</td>\n              <td><span class=\"m-auto material-icons cl-red2 cr-pointer\">delete</span></td>\n              </tr>\n          </tbody>\n      </table>\n    </div>\n      </div>\n    </div>\n    <div class=\"container uk-margin-top\" v-show=\"tables.length\">\n      <ul class=\"uk-grid uk-grid-small uk-flex-center\">\n          <li v-if=\"filter.page>1\">\n            <a class=\"cl-dark\" href=\"#\" @click.prevent=\"filter.page--; searchLeads()\">\n              <span class=\"material-icons\">chevron_left</span>\n            </a>\n          </li>\n          <li v-if=\"(filter.page - 3) > 1 \">\n            <a class=\"cl-dark\" href=\"#\" @click.prevent=\"filter.page -= 3; searchLeads()\">\n              {{ filter.page - 3 }}\n            </a>\n          </li>\n          <li v-if=\"(filter.page - 2) > 1 \">\n            <a class=\"cl-dark\" href=\"#\" @click.prevent=\"filter.page -= 2; searchLeads()\">\n              {{ filter.page - 2 }}\n            </a>\n          </li>\n\n          <li v-if=\"(filter.page - 1) >= 1 \">\n            <a class=\"cl-dark\" href=\"#\" @click.prevent=\"filter.page--; searchLeads()\">\n              {{ filter.page - 1 }}\n            </a>\n          </li>\n\n          <li>\n            <a class=\"cl-dark cl-vevanta\" href=\"#\" @click.prevent>\n              {{ filter.page }}\n            </a>\n          </li>\n\n          <li v-if=\"(filter.page + 1) < last_page\">\n            <a class=\"cl-dark\" href=\"#\" @click.prevent=\"filter.page++; searchLeads()\">\n              {{ filter.page + 1 }}\n            </a>\n          </li>\n          <li v-if=\"(filter.page + 2) < last_page\">\n            <a class=\"cl-dark\" href=\"#\" @click.prevent=\"filter.page += 2; searchLeads()\">\n              {{ filter.page + 2 }}\n            </a>\n          </li>\n          <template  v-if=\"filter.page < last_page\">\n            <li class=\"\"><span> ... </span></li>\n            <li>\n              <a class=\"cl-dark\" href=\"#\" @click.prevent=\"filter.page = last_page; searchLeads()\">\n                {{ last_page }}\n              </a>\n            </li>\n            <li>\n              <a class=\"cl-dark\" href=\"#\" @click.prevent=\"filter.page++; searchLeads()\">\n                <span class=\"material-icons\">chevron_right</span>\n              </a>\n            </li>\n          </template>\n      </ul>\n    </div>\n\n  </div>\n</template>\n\n<script>\n\n  export default {\n    data() {\n      return {\n        statusLeads: 0,\n        tables : [],\n        sortDomainActive : '',\n        sortCompanyActive : '',\n        sortOriginActive : '',\n        domains : [],\n        companies : [],\n        origins : [],\n        date_period : [],\n        total: 0,\n        last_: 0,\n        first_page: 1,\n        pages: [],\n        filter: {\n          domain: [],\n          company: [],\n          origin: [],\n          date_period: [],\n          page: 1,\n        }\n      }\n    },\n\n    created() {\n      if (this.$route.query.domain) {\n        this.filter.domain = [this.$route.query.domain]\n      }\n      if (this.$route.query.company) {\n          this.filter.company = [this.$route.query.company]\n      }\n      if (this.$route.query.origin) {\n        this.filter.origin = [this.$route.query.origin]\n      }\n      if (this.$route.query.page) {\n          this.filter.page = this.$route.query.page\n      }\n      if (this.$route.query.date_period) {\n          let date = this.$route.query.date_period.split(',')\n\n         if (date.length === 2) {\n            this.filter.date_period = date\n          }\n      }\n\n      this.searchLeads()\n      this._get_domains()\n      this._get_companies()\n      this._get_origins()\n  },\n\n    methods: {\n      searchLeads() {\n\n        let qs = Object.keys(this.filter).filter(key => {\n         if (Array.isArray(this.filter[key]) && this.filter[key].length) {\n           return true\n         } else if (typeof this.filter[key] === 'string' && this.filter[key]) {\n           return true\n         } else if (typeof this.filter[key] === 'number') {\n           return true\n         } else {\n           return false\n         }\n       }).map(key => `${key}=${this.filter[key]}`).join('&')\n\n\n       let stateObj = {\n         foo: 'crm'\n       }\n      history.pushState(stateObj, \"page 2\", `/CRM/?${qs}`)\n\n\n        this.tables = []\n        this.statusLeads = 0\n        let filter = this.filter\n\n        if (this.$refs.tablesLeads) {\n          this.$refs.tablesLeads.scrollIntoView()\n        }\n\n        this.$api.post('lead/get_leads',{filter})\n        .then(rs => {\n          console.log(rs.data)\n           this.tables = rs.data.data\n           this.total = rs.data.total\n           this.last_page = rs.data.last_page\n           this.filter.page = rs.data.current_page\n           this.statusLeads = 1\n\n        })\n      },\n\n\n\n      _get_domains() {\n        this.$api.post('lead/get_domains')\n        .then(rs => {\n           this.domains = rs.data.data\n        })\n      },\n      _get_companies() {\n        this.$api.post('lead/get_companies')\n        .then(rs => {\n           this.companies = rs.data.data\n      })\n    },\n      _get_origins() {\n        this.$api.post('lead/get_origins')\n        .then(rs => {\n           this.origins = rs.data.data\n      })\n    },\n    startLeadDate() {\n      if (this.filter.date_period.length === 2) {\n        if (this.filter.date_period[0] && this.filter.date_period[1]) {\n          this.filter.page = 1\n          this.searchLeads()\n        }\n      }\n    },\n  }\n}\n</script>\n\n\n<style>\n.preload__cont {\n  width: 100%;\n  height: 100%;\n  background: rgb(255 255 255 / 74%);\n}\n\n.preload__cont img {\n  width: 60px;\n  margin-right: 400px;\n}\n\n</style>\n"]}]}